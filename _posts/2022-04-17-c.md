---
title:  "C언어 코드 관련 정리"
excerpt: "C언어 코드 작성 및 분석 시 필요한 배경지식"

categories:
  - Embedded
tags:
  - [Handler, Interrupt]

toc: true
toc_sticky: true

date: 2023-04-17
last_modified_at: 2023-06-17
---

## Handler  
임베디드 시스템에서 handler는 이벤트나 인터럽트 등의 외부적인 요인으로부터 처리해야할 일이 발생했을 때, 이를 처리하기 위한 함수나 코드 블록을 가리키는 포인터를 말한다.  
주로 장치 드라이버, 운영 체제, 응용 프로그램 등에서 사용되며 이벤트나 인터럽트가 발생 시 매우 빠른 속도로 처리해야하기 때문에 최적화가 필요하다.  
  
예를 들어, 인터럽트 핸들러는 특정 인터럽트가 발생했을 때 호출되는 함수를 가리키는 포인터가 된다.  
  
이러한 핸들러가 가리키는 특정 기능을 구현한 함수는 프로젝트에 따라 다르지만 일반적으로 시스템의 핵심 기능을 담당하기 때문에 보안 및 안정성 등의 이유로 공개되어 있지 않다.  
<br>  

## 함수 호출의 오버헤드란?  
함수가 호출되면 프로그램은 반환 주소 저장, 지역 변수용 스택 공간 할당, 함수 호출 스택 프레임 설정과 같은 작업을 수행하는데 이 때, 인라인으로 직접 실행하는 것에 비해 필요한 추가 시간과 리소스를 말한다.  
  
간단한 함수나 호출 수가 적은 프로그램에서는 큰 차이가 없어보일 수 있으나 성능이 중요한 경우나 자주 호출되는 함수에서는 함수 호출의 오버헤드가 누적되어 프로그램의 전체 성능에 영향을 미칠 수 있다.  
오버헤드를 줄이고 성능을 향상시키기 위해 포인터를 사용하거나 인라인 함수를 사용한다.  
<br>  

## 인라인 함수  
컴파일러에게 함수 호출 부분을 호출하는 대신 함수의 실제 코드로 대체하도록 지시하는 프로그래밍 구조이다.  
  
함수의 코드가 호출되는 위치에 직접 삽입되기 때문에 함수 호출의 오버헤드를 없앨 수 있다.  
특정 상황에서 성능을 향상시킬 수 있지만 코드 크기를 증가시킬 수도 있기 때문에 코드 크기와 성능 향상 사이의 균형을 고려하려 신중히 사용하여야 한다.  
  
inline 키워드를 사용해 함수를 인라인으로 지정할 수 있지만 이것은 컴파일러에 대한 제안일 뿐이기 때문에 컴파일러의 최적화 및 제약 사항에 따라 실제로 함수가 인라인으로 처리되지 않을 수도 있다. 
```c  

```  
  
## 인터럽트  
```c  
#include <stdint.h>
#include <stdbool.h>

// 인터럽트 함수임을 알리는 매크로
#define INTERRUPT_HANDLER __attribute__((interrupt))

// inline 함수로 정의
static inline void myInterruptHandler(void) {
    // 인터럽트 발생 시 실행되는 코드
}

// 인터럽트 함수로 등록
void registerInterruptHandler(void) {
    // 인터럽트 핸들러 등록
    INTERRUPT_HANDLER void (*intHandler)(void) = &myInterruptHandler;
    
    // 인터럽트 레지스터에 핸들러 등록
    // ...
}
```  
